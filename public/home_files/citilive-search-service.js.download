var CitiSearchService=(function(){var l=false;var t={};var h="SBizContext_GlobalSearch";var o="SBizContext_GlobalSearch";var d="SBizContext_WEB-"+CitiSearchConfig.userCategory+"-DRAWER-LIVE";var n="SBizContext_WEB-"+CitiSearchConfig.userCategory+"-PAGE-LIVE";var a="SBizContext_WEB-"+CitiSearchConfig.userCategory+"-FULL";if(window.citiSearchNgBody==true){var u=function(){var H="";var F=document.URL;F=F.split("/");for(var G=3;G<(F.length-1);G++){F[G];H+="../"}F=F[3];return[F,H]};var z=u();var r=z[0];var y=z[1];var e="";var v=y+r+"/REST/dvaResource/dvaSearchWebservice.jws?moduleName="+CitiSearchConfig.moduleName;var B=function(){var F=y+r+"/REST/dvaResource/getConditionalFAQList.jws";var G=y+r+"/REST/dvaResource/dvaSmartSearchNavigation.jws?";return{condFAQURL:F,smartSearchNavigationURL:G}};var f=y+r+"/REST/dvaResource/dvaGetJSVariables.jws";var w=y+r+"/REST/dvaResource/dvaFetchContentWebservice.jws?locale="+CitiSearchConfig.lang}else{var v=CitiSearchConfig.cbolUrlSearch+"/US/REST/dvaResource/dvaSearchWebservice.jws?moduleName="+CitiSearchConfig.moduleName;var B=function(){var F=CitiSearchConfig.cbolUrlSearch+"/US/REST/dvaResource/getConditionalFAQList.jws";var G=CitiSearchConfig.cbolUrlSearch+"/US/REST/dvaResource/dvaSmartSearchNavigation.jws?";return{condFAQURL:F,smartSearchNavigationURL:G}};var f=CitiSearchConfig.cbolUrlSearch+"/US/REST/dvaResource/dvaGetJSVariables.jws";var w=CitiSearchConfig.cbolUrlSearch+"/US/REST/dvaResource/dvaFetchContentWebservice.jws?locale="+CitiSearchConfig.lang}var E=function(H,G,F,J,I){if(l){if(console&&console.log){console.log("-------------------------------- "+H+" --------------------------------");console.log("cmd : "+JSON.stringify(G));if(J=="success"){console.log("data : "+JSON.stringify(F));console.log("textStatus : "+J);console.log("jqXHR : "+JSON.stringify(I))}else{console.log("jqXHR : "+JSON.stringify(F));console.log("textStatus : "+J);console.log("errorThrown : "+JSON.stringify(I))}console.log("-------------------------------------------------------------------------")}}};var m=function(G,H,F){$CitiSearch.ajax({url:v,type:"POST",crossDomain:true,contentType:"application/x-www-form-urlencoded",data:{cmd64:Base64.encode(JSON.stringify(G))}}).done(function(M,N,L){if(typeof(M)=="string"){M=JSON.parse(M)}if(N=="success"&&M.ok&&M.status=="200"){if(M.searchResults.hasOwnProperty("contextualData")){t=M.searchResults.contextualData}var K=[];for(var I=0;I<M.searchResults.results.length;I++){if(M.searchResults.results[I].contentType=="faq"){K.push(M.searchResults.results[I].contentId)}}if(K.length>0){b(K,function(R){for(var Q=0;Q<R.result.length;Q++){var O=JSON.parse(R.result[Q]);for(var P=0;P<M.searchResults.results.length;P++){if(M.searchResults.results[P].contentId==O.UniqueID){M.searchResults.results[P].answer=O.DecodedAnswerText}}}})}}if(CitiSearchConfig.lang=="es"){var J=j(M)}else{var J=(M)}H(J)}).fail(function(I,L,K){console.log(L);console.log(K);var J={ok:false};H(J)}).always(function(I,K,J){E(F,G,I,K,J)})};var c=function(G,H,F){$CitiSearch.ajax({url:v,type:"POST",crossDomain:true,contentType:"application/x-www-form-urlencoded",data:{cmd64:Base64.encode(JSON.stringify(G))}}).done(function(J,K,I){if(typeof(J)=="string"){J=JSON.parse(J)}if(K=="success"&&J.status=="200"){H(J)}}).fail(function(I,L,K){console.log(L);console.log(K);var J={ok:false};H(J)}).always(function(I,K,J){E(F,G,I,K,J)})};var A=function(G){var F={type:"getSearchResults",bankInfo:{ctxId:d,command:"default_search"},pageId:CitiSearchConfig.pageId,maxNumOfResults:10,protocolVersion:2.1,contextualData:t,lang:CitiSearchConfig.lang};m(F,G,"getDefaultSearchData")};var i=function(H,G){var F={type:"getRelatedContent",bankInfo:{ctxId:d},pageId:CitiSearchConfig.pageId,contentId:H,contentType:"faq",maxNumOfResults:10,protocolVersion:2.1,contextualData:t,lang:CitiSearchConfig.lang};m(F,G,"getRelatedHelp")};var q=function(H,G){var F={type:"notifyEvent",checkInPastEvent:true,eventInfo:{type:"ContentSelection",params:{contentId:H,contextualData:t},protocolVersion:2.1,lang:CitiSearchConfig.lang}};c(F,G,"notifyEvent")};var k=function(I,F,H){var G={type:"notifyEvent",checkInPastEvent:true,eventInfo:{type:"ContentFeedback",params:{contentId:I,feedbackComment:"",FeedbackRate:F,contextualData:t},protocolVersion:2.1,lang:CitiSearchConfig.lang}};c(G,H,"notifyFeedBack")};var D=function(J,F,G,I){var H={type:"notifyEvent",checkInPastEvent:true,eventInfo:{type:"ContentFeedback",params:{contentId:J,feedbackComment:F,FeedbackRate:G,contextualData:t},protocolVersion:2.1,lang:CitiSearchConfig.lang}};c(H,I,"submitFeedBack")};var C=function(J,K,F,M,I,G,N){var L=[];var O=false;L=JSON.parse(I);if(L.length>0){O=true}if(K=="full_search"){var H={type:"getSearchResults",bankInfo:{ctxId:a,command:"full_search",autoCorrect:G,autoComplete:{typeText:J}},pageId:CitiSearchConfig.pageId,maxNumOfResults:100,protocolVersion:2.1,contextualData:t,lang:CitiSearchConfig.lang,isContextual:O,expandedContent:L}}else{var H={type:"getSearchResults",bankInfo:{ctxId:o,command:"related_search",autoCorrect:false},pageId:CitiSearchConfig.pageId,maxNumOfResults:100,protocolVersion:2.1,contextualData:{},lang:CitiSearchConfig.lang,isContextual:O,contentType:M,contentId:F,expandedContent:L}}m(H,N,"getFullSearchData")};var g=function(G,H){var F={type:"getSearchResults",isLog:true,bankInfo:{ctxId:d,command:"live_search",autoCorrect:false,autoComplete:{typeText:G}},pageId:CitiSearchConfig.pageId,maxNumOfResults:10,protocolVersion:2.1,contextualData:t,lang:CitiSearchConfig.lang};m(F,H,"getLiveSearchData")};var s=function(I,G,F,J){var H={type:"getSearchResults",isLog:true,bankInfo:{ctxId:n,command:"live_search",autoCorrect:false,autoComplete:{typeText:I}},pageId:CitiSearchConfig.pageId,maxNumOfResults:100,protocolVersion:2.1,contextualData:{},lang:CitiSearchConfig.lang,isContextual:false,expandedContent:[]};m(H,J,"getLiveSearchFull")};var p=function(F){$CitiSearch.ajax({url:w,crossDomain:true,type:"POST",}).done(function(H,I,G){if(typeof(H)=="string"){H=JSON.parse(H)}if(I=="success"){F(H)}}).fail(function(G,I,H){console.log(H)}).always(function(G,I,H){E("fecthContentData",{},G,I,H)})};var x=function(F){$CitiSearch.ajax({url:f,type:"POST",crossDomain:true,contentType:"application/x-www-form-urlencoded",data:{moduleName:CitiSearchConfig.moduleName}}).done(function(H,I,G){if(typeof(H)=="string"){H=JSON.parse(H)}if(I=="success"){if(H.hasOwnProperty("cboldomain")){e=H.cboldomain}F(H)}}).fail(function(G,I,H){console.log(H)}).always(function(G,I,H){E("fetchJSVar",{},G,I,H)})};var b=function(G,H){var F=B().condFAQURL;$CitiSearch.ajax({url:F,type:"POST",async:false,crossDomain:true,contentType:"application/x-www-form-urlencoded",data:{cmd64:Base64.encode(JSON.stringify(G))}}).done(function(J,K,I){if(typeof(J)=="string"){J=JSON.parse(J)}if(K=="success"){H(J)}}).fail(function(I,K,J){console.log(J)}).always(function(I,K,J){E("fecthContentData",{},I,K,J)})};var j=function(G){if(G.ok){var F=_.reject(G.searchResults.results,function(I){return I.url=="NavigateCS"});var H=G;H.searchResults.results=F;return H}else{return G}};return{getDefaultSearchData:A,getRelatedHelp:i,notifyEvent:q,notifyFeedBack:k,submitFeedBack:D,getLiveSearchData:g,getFullSearchData:C,getLiveSearchFull:s,fetchContentData:p,fetchJSVar:x,getThirdPartiesDomain:B}})();var nexusPlatformChatEscalationCBOL=new NexusPlatformChatEscalationCBOL();var CitiSearchDelegate=function(){this.navigateToPage=function(f){if(!f.url||!f.urlType){return}if(f.urlType.toLowerCase()=="navigate"){console.log("SampleEventDelegate: navigateToPage()- urlType: "+f.urlType+"url: "+f.url+" searchTerm: "+f.searchTerm);
if(f.url=="NavigateCS"){nexusPlatformChatEscalationCBOL.escalationToChat(f)}else{var h=Base64.encode(f.url);var l=Base64.encode(f.searchTerm);var d=function(){var o="";var m=document.URL;m=m.split("/");for(var n=3;n<(m.length-1);n++){m[n];o+="../"}m=m[3];return[m,o]};var c=d();var b=c[0];var k=c[1];var i=CitiSearchService.getThirdPartiesDomain().smartSearchNavigationURL;var j=document.createElement("form");j.setAttribute("method","post");j.setAttribute("action",i);j.setAttribute("id","smartSearchNavigationformID");if(typeof CitiSearchJSVar.navigateToNewTab!="undefined"||null!=CitiSearchJSVar.navigateToNewTab){var g=CitiSearchJSVar.navigateToNewTab.split(",");if(g.indexOf(f.url)>=0){j.setAttribute("target","_blank")}}var e=document.createElement("input");e.setAttribute("type","hidden");e.setAttribute("value",h);e.setAttribute("name","navigateIdEncoded");j.appendChild(e);var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("value",l);a.setAttribute("name","encodedSearchTerm");j.appendChild(a);document.getElementsByTagName("body")[0].appendChild(j);document.getElementById("smartSearchNavigationformID").submit()}}else{if(f.urlType.toLowerCase()=="public"){console.log("SampleEventDelegate: navigateToPage()- urlType: "+f.urlType+" url: "+f.url);window.location.href=f.url}else{if(f.urlType.toLowerCase()=="noresults"){console.log("SampleEventDelegate: navigateToPage()- urlType: "+f.urlType+" url: "+f.url);window.location.href=f.url}}}}};