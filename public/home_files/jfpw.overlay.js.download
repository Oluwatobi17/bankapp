CJW.jfp.widget.Overlay=JFPWClass.extend(CJW.jfp.widget.Object,{className:"CJW.jfp.widget.Overlay",selector:null,instance:null,ready:false,returnFocus:null,initialize:function(d,b,c){d=d||{};b=b||{};c=c||{};this.oCfg={};this.topicConfig={};JFP.cp(this.oCfg,d,{wrapperSet:"__UNK__"});this.selector=this.oCfg.wrapperSet;delete this.oCfg.wrapperSet;delete this.oCfg.modal;JFP.cnp(this.oCfg,b);JFP.cnp(this.oCfg,CJW.jfp.widget.Overlay.defaults);this.dialog=this.oCfg.dialog;this.returnFocus=this.oCfg.returnFocus;this.closeAfter=this.oCfg.closeAfter;delete this.oCfg.dialog;delete this.oCfg.returnFocus;if(this.dialog==true){defaultStyle="jfpw-dialog"}else{defaultStyle="jfpw-overlay"}JFP.cnp(this.oCfg,{styleClass:defaultStyle});this.shadow=this.oCfg.shadow;delete this.oCfg.shadow;this.oCfg.dialogClass=this.oCfg.styleClass;var a=$jq(this.selector).first();if(!a.hasClass("jfpw-hidden")){a.addClass("jfpw-hidden")}this.applyCfg();this.setTopics(c);if("__delayWidgetIns__disable" in window||this.oCfg.delayCreate===false){this._create()}},applyCfg:function(){if(!this.wigdetId){this.wigdetId=this.selector.substring(1)+"-parent";this.titleBarSelector="#"+this.wigdetId+" > .ui-dialog-titlebar"}if(this.ready==true){this.instance.dialog("option",this.oCfg)}},getProperty:function(a){return this.instance.dialog("option",a)},setProperty:function(b,c){var a={};a[b]=c;this._setInternalProperties(a);if(this.ready==true){this.instance.dialog("option",a)}},setProperties:function(a){a=a||{};this._setInternalProperties(a);this.unbindEvents();if(this.ready==true){this.instance.dialog("option",a)}this.bindEvents()},_setInternalProperties:function(a){var c=null;var b=null;for(c in a){b=a[c];switch(c){case"wrapperSet":delete a.wrapperSet;break}}},_create:function(){if(this.ready==true){return}this.instance=$jq(this.selector).first();this.instance.removeClass("jfpw-hidden");this.instance.dialog(this.oCfg);this.ready=true;this._widget().find("a.ui-dialog-titlebar-close").attr("aria-label",this.oCfg.closeAriaText);var a=this._widget().first();if(a.children().first().hasClass("ui-dialog-titlebar")){a.children().first().attr("role","presentation").find(".ui-dialog-title").attr({role:"heading","aria-level":"1"});a.children().first().find(".ui-icon-closethick").attr("role","presentation")}this._widget().attr("aria-live","off");this.initEvents();this.triggerPostConstruction()},initEvents:function(){this.unbindEvents();this.bindEvents()},unbindEvents:function(){this.instance.unbind("dialogopen",this._dialogOpenHandlerFn);this.instance.unbind("dialogclose",this._dialogCloseHandlerFn);this.instance.unbind("dialogdrag",this._dialogDragHandlerFn);this.instance.unbind("dialogresize",this._dialogResizeHandlerFn);this.instance.unbind("dialogdragstart",this._dialogDragHandlerFn);this.instance.unbind("dialogdragstop",this._dialogDragHandlerFn);this.instance.parent().unbind("mouseenter.jfpwoverlay");this.instance.parent().unbind("mouseleave.jfpwoverlay")},bindEvents:function(){var a={topic:this.oCfg.eventsTopicName,wrapper:this,selector:this.selector};this.instance.bind("dialogopen",a,this._dialogOpenHandlerFn);this.instance.bind("dialogclose",a,this._dialogCloseHandlerFn);this.instance.bind("dialogdrag",a,this._dialogDragHandlerFn);this.instance.bind("dialogresize",a,this._dialogResizeHandlerFn);this.instance.bind("dialogdragstart",a,this._dialogDragHandlerFn);this.instance.bind("dialogdragstop",a,this._dialogDragHandlerFn);this.instance.parent().bind("mouseenter.jfpwoverlay",a,function(b){b.data.wrapper.instance.find("div.gp7 > div.jfpw-slider-vertical > a.ui-slider-handle").addClass("jfpw-state-active")});this.instance.parent().bind("mouseleave.jfpwoverlay",a,function(b){b.data.wrapper.instance.find("div.gp7 > div.jfpw-slider-vertical > a.ui-slider-handle").removeClass("jfpw-state-active")})},_dialogOpenHandlerFn:function(a){a.data.wrapper._dialogOpenHandler(a)},_dialogOpenHandler:function(b){var a=this._widget();a.attr("id",this.wigdetId);a.attr("aria-hidden","false");if(this.shadow===true){a.addClass("jfpw-overlay-shadow")}this._widget().focus();this.disableParentAccesibilty()},disableParentAccesibilty:function(){if(this._widget()&&this._widget().siblings()){this._widget().siblings().filter("div:not('.ui-widget-overlay'),span, a").attr("aria-hidden",true)}},_dialogCloseHandlerFn:function(a){a.data.wrapper._dialogCloseHandler(a)},_dialogCloseHandler:function(b){if(this.returnFocus!=null){$jq(this.returnFocus).focus()}var a=this.instance.parent();a.attr("aria-hidden","true");this.instance.find(".jfpw-tooltip-cursor").each(function(){$jq("#"+$jq(this).attr("id")).jfpwidget("hide")});this._enableParentAccesibilty()},_enableParentAccesibilty:function(){if(this._widget()&&this._widget().siblings()){this._widget().siblings().filter("div:not('.ui-widget-overlay'),span, a").removeAttr("aria-hidden",false)}},_dialogDragHandlerFn:function(a,b){a.data.wrapper._dialogDragHandler(a,b)},_dialogDragHandler:function(a,b){this.publishEvent(a)},_dialogResizeHandlerFn:function(a){a.data.wrapper._dialogResizeHandler(a)},_dialogResizeHandler:function(a){this.publishEvent(a)},hideTitleBar:function(){var a=$jq(this.titleBarSelector);var b=a.css("height");if(b===undefined){b=0}else{b=b.replace(/px/gi,"")}this.oTBH=parseInt(b)+"px";a.hide();a.css({height:"0px"});this.instance.data("dialog")._size()},showTitleBar:function(){var a=$jq(this.titleBarSelector);a.css({height:this.oTBH});a.show();this.instance.data("dialog")._size()},destroy:function(){if(this.ready==false){return}this._destroy$();this.unbindEvents();this.instance.dialog("destroy");this.ready=false},disable:function(){if(this.ready==false){return}this.instance.dialog("disable");$jq(this.selector).find("*").attr("disabled",true)},enable:function(){if(this.ready==false){return}this.instance.dialog("enable");$jq(this.selector).find("*").attr("disabled",false)},close:function(){if(this.ready==false){return}this.instance.dialog("close")},isOpen:function(){if(this.ready==false){return}return this.instance.dialog("isOpen")},moveToTop:function(){if(this.ready==false){return}this.instance.dialog("moveToTop")},open:function(){if(this.ready==false){this._create()}this.lastFocus=document.activeElement;this.instance.dialog("open");if(this.oCfg.hideTitleBar==true){this.hideTitleBar()}if(this.closeAfter){var a=this;var b=function(){a.close()};setTimeout(b,this.closeAfter)}},_widget:function(){if(this.ready==false){return}return this.instance.dialog("widget")},widget:function(){if(this.ready==false){return}return this.instance}});CJW.jfp.widget.Overlay.defaults={modal:true,draggable:false,resizable:false,dialog:false,autoOpen:false,closeText:"",resizable:false,returnFocus:null,position:["center",140],title:"",width:300,height:300,shadow:true,shadowOffset:10,hideTitleBar:false,closeAriaText:"Close overlay"};window.$RDY&&$RDY.complete("CJW.jfp.widget.Overlay");